---
title: "実行日の日付の取得"
free: false
---
OSで地域を日本に設定している場合、 `%DATE%` で `yyyy/mm/dd` 形式の日付を得られます。スラッシュを削除して `yyyymmdd` 形式で得る場合、環境変数の置換機能を使って `%DATE:/=%` とします。

ただし、「年/月/日」の順番でならんでいるのは日本だけで、米国では「月/日/年」、英国では「日/月/年」であるため、海外ではまったくあてになりません。

また、%DATE% のフォーマットそのものも

> コントロールパネル
→ 日付、時刻、数値形式の変更
→ 日付と時刻の形式
→ 日付(短い形式)(S)：

でユーザの手で用意に変更できてしまいます。

普通、こんな設定を変えることはないだろうと思いがちですが、この設定は Windows11 のタスクバーでの日付表示フォーマットでもあるため「曜日もタスクバーで確認したい」というニーズのため「yyyy/MM/dd dddd」と変更するいう方法も Tips として紹介されていたりします。この dddd 部分は日本語の曜日となってしまうため、使い方によってはこれが文字化けの原因にもなりえます。

このような OS の設定に関係なく、確実に `yyyymmdd` 形式で得るには、wmic というコマンドが使えます。

```batch
$ wmic os get LocalDateTime
LocalDateTime
20200403103451.442000+540

```

これを FOR で抽出して、環境変数に代入すればよいでしょう

```batch
for /F %%I in ('wmic os get LocalDateTime ^| findstr ^^[1-9]') do set DT=%%I
echo %DT:~0,8%
```

wmic は最後に余計な空行を1行出力するため、それで環境変数を上書きしないよう注意が必要です。
