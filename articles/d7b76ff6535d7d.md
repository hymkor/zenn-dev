---
title: "ã€Œã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚·ã‚§ãƒ«ï¼Ÿï¼Ÿï¼Ÿã€€èª°ã§ã‚‚ä½œã‚Œã¾ã™ã‚ˆã€"
emoji: "ğŸ“˜"
type: "tech"
topics: ["go", "shell"]
published: true
---

ã€Œã¾ã•ã‹ã€ã‚ãªãŸâ€¦ä½œã‚Œãªã„ã‚“ã§ã™ã‹ï¼Ÿã€ï¼ˆä¸å®‰ã‚’ç…½ã£ã¦ã‚†ãå•†æ³•ï¼‰
### ç¸›ã‚Šæ¡ä»¶

- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚·ã‚§ãƒ«ã‚’ä½œã‚‹
- è‡ªåˆ†ã§ä½œã£ãŸ [nyagos](https://github.com/zetamatta/nyagos) å‘ã‘ã®æ—¢å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä½¿ã‚ãªã„
- ä»–äººãŒä½œã£ãŸæ—¢å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä½¿ã£ã¦ã‚ˆã„ï¼ˆä½œæˆã‚’ä¾é ¼ã—ã¦ã¯ãƒ€ãƒ¡ï¼‰
- è‡ªåˆ†ã®ã‚³ãƒ¼ãƒ‰ã¯ go run ã‚³ãƒãƒ³ãƒ‰ã§å‹•ã‹ã›ã‚‹ç¯„å›²ã®ã¿ï¼ˆã¤ã¾ã‚Šï¼‘ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- å‹•ãã“ã¨ï¼

### å¿…è¦æœ€å°é™ã®ãƒŸãƒ‹ãƒãƒ ãªéª¨æ ¼ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã®é’å†™çœŸ

```c
while ( true ){
ã€€text = readline()// ä¸€è¡Œå…¥åŠ›ï¼šæœ€æ‚ª gets ã§ã‚‚ã‚ˆã„
ã€€system(text) /// ä¸€è¡Œå®Ÿè¡Œï¼šæœ€æ‚ª CMD.EXE ã¨ã‹ã«ä¸¸æŠ•ã’ã—ã¦ã‚‚ã‚ˆã„
}
```

æœ€åˆã¯ã€Œæœ€æ‚ªã€ã ã‘ã§ã„ã„ã‚“ã§ã™

### ä»Šå›ã®ãƒãƒªã‚·ãƒ¼çš„ãªæ–¹å‘æ€§ã«ã¤ã„ã¦ã®æ–¹é‡

- ä¸€è¡Œå…¥åŠ›ã¯ã€"[github.com/mattn/go-tty](https://github.com/mattn/go-tty)" ã«ã¤ã„ã¦ãŸ ttyutil ã® ReadLine ã‚’æ‹å€Ÿã—ã‚ˆã†
    - æœ€åˆã¯getsç›¸å½“ã‚’ã‚„ã‚ã†ã‹ã¨æ€ã£ãŸãŒã€bufio.NewScannerã¨ã‹ã€ã‹ãˆã£ã¦ã‚ã‚“ã©ã„ã‚ˆã†ã«æ€ã£ãŸ
    - ãŒã€å®Ÿéš›ã¯ãã‚“ãªã“ã¨ãªã„ãã‚‰ã„ã€ttyã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”¨æ„ã§è¡Œæ•°æ¶ˆè²»ã—ãŸ
- ä¸€è¡Œå®Ÿè¡Œãã‚‰ã„ã¯ "os/exec" ã§è»½ãå®Ÿè£…ã—ã‚ˆã†  
  
### ã‚«ã‚¿ã‚«ã‚¿ã‚«ã‚¿

```go
package main

import (
	"fmt"
	"os"
	"os/exec"
	"strings"

	"github.com/mattn/go-tty"
	"github.com/mattn/go-tty/ttyutil"
)

func mains() error {
	fmt.Println("Tiny Shell. Type Ctrl-D to quit.")

	tty1, err := tty.Open()
	if err != nil {
		return err
	}
	defer tty1.Close()

	for {
		clean, err := tty1.Raw()
		if err != nil {
			return err
		}
		fmt.Println("Ready")
		text, err := ttyutil.ReadLine(tty1)
		clean()
		if err != nil {
			return err
		}

		fields := strings.Fields(text)
		if len(fields) <= 0 {
			continue
		}
		cmd := exec.Command(fields[0], fields[1:]...)
		cmd.Stdout = os.Stdout
		cmd.Stderr = os.Stderr
		cmd.Stdin = os.Stdin
		cmd.Run()
	}
}

func main() {
	if err := mains(); err != nil {
		fmt.Fprintln(os.Stderr, err.Error())
		os.Exit(1)
	}
}
```

### èª¬æ˜ã—ã‚ˆã†ï¼

- `main()`ã®ä¸­ã‹ã‚‰`mains()error`ã‚’å‘¼ã¶ã®ã¯ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’ç°¡ç•¥åŒ–ã™ã‚‹ã€ã‚ãŸãã—ã®ã‚¹ã‚¿ã‚¤ãƒ«ãªã‚“ã§ã€ã‚ã‚“ã¾ã‚Šæ°—ã«ã—ãªã„ã§ã„ã„ã§ã™ã€‚
- ã‚ˆãè¦‹ã‚‹ã¨ã€åŠåˆ†ãã‚‰ã„ https://github.com/zetamatta/go-readline-ny/#example2go ã®æ”¹å¤‰ç‰©ã ãŒã€èª°ã‚‚ã‚³ãƒ”ãƒšãŒãƒ€ãƒ¡ã¨ã¯è¨€ã£ã¡ã‚ƒã‚ã„ãªã„ï¼ˆ**ã‚­ã‚¿ã­ã‡ãï¼**ï¼‰
- ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¸ŠåŠåˆ†ã¯ä¸€è¡Œå…¥åŠ›ã‚’è¡Œã†ï¼ˆ=ReadLine ã‚’å‘¼ã¶ï¼‰ãŸã‚ã®ã€æº–å‚™ä½œæ¥­ï¼ˆï¼‘æ–‡å­—ã‚­ãƒ¼å…¥åŠ›ã®åˆæœŸåŒ–ï¼‰ã«è²»ã‚„ã•ã‚Œã¦ã„ã‚‹ã€‚ã“ã“ã¯ go-tty ã®**ä»•æ§˜ã ã‹ã‚‰ã‚·ãƒ¨ã‚¦ãŒãªã„ã€‚ã€‚**
    - go-tty ã¯ãã‚‚ãã‚‚ã®ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å…¥åŠ›ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€ã“ã‚Œã‚’ä½¿ã†ã¨ Enter ã‚­ãƒ¼ãªã—ã®ã‚­ãƒ¼å–å¾—ãŒå¯èƒ½ã«ãªã‚‹ã€‚ttyutil.ReadLine ã¯ãã®ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®
    - go-tty ã¯UNIXã®ç«¯æœ«æ“ä½œã®ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’æ¨¡ã—ã¦ã„ã‚‹ï¼ˆWindowsã§ã¯ãƒ©ãƒƒãƒ‘ãƒ¼ã§ã¯ãªãã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ã„ã‚‹ï¼‰ã€‚UNIXç³»ç«¯æœ«ã«ã¯ Cocked ãƒ¢ãƒ¼ãƒ‰ã¨ Raw ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Šã€å‰è€…ã¯ EnterãŒæŠ¼ä¸‹ã•ã‚Œã‚‹ã¾ã§ç«¯æœ«ä»»ã›ã®ç·¨é›†ãŒè¡Œã‚ã‚Œã‚‹ãŒã€ã“ã®çŠ¶æ…‹ã§ã¯ Backspace ãªã©ç°¡å˜ãªè¨‚æ­£ãŒå¯èƒ½ãªã ã‘ã§ã€ã¾ã¨ã‚‚ãªç·¨é›†æ©Ÿèƒ½ãŒã‚ã‚‹ã¨ã¯ã„ã„ãŒãŸã„ã€‚Emacs-like ãªè¤‡é›‘ãªç·¨é›†ã‚’è¡Œã†ã«ã¯ Rawãƒ¢ãƒ¼ãƒ‰ã¨ã„ã£ã¦ã€å…¥åŠ›æ–‡å­—ã‚’ãã®ã¾ã¾ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é€ä¿¡ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ç´°ã‹ãã‚­ãƒ¼ã®è§£é‡ˆãƒ»ã‚«ãƒ¼ã‚½ãƒ«ã®ç§»å‹•ã‚’è¡Œã‚ãªãã¦ã¯ã„ã‘ãªã„ã€‚ä»Šå›ã¯ãã†ã„ã†ã‚ã‚“ã©ãã•ã„ã“ã¨ã¯ ReadLine ã«ä¸¸æŠ•ã’ã ï¼
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã ãŒã€ã©ã†ã‚‚ ttyutil.ReadLine ã ã¨ä¸Šæ›¸ãã•ã‚Œã‚‹ã®ã‹ã€ã†ã¾ãã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã«æ›¸ã‘ãªã‹ã£ãŸã®ã§ã€ä»Šå›ã¯ F-BASICé¢¨ã«ã€ŒReadyã€ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã—ã¦ã€8bité¢¨å‘³ã«ã—ã¦ã”ã¾ã‹ã—ãŸã€‚
- å¾ŒåŠã¯å…¥åŠ›ã—ãŸä¸€è¡Œã‚’å˜èªå˜ä½ã«åˆ†å‰²ã—ã¦ã€ãã‚Œã‚’ exec.Command ã«ãã¹ã¦ã„ã‚‹ã ã‘

**ã€Œã­ã€ç°¡å˜ã§ã—ã‚‡ï¼Ÿã€**

### TO BE CONTINUED...?

- ç’°å¢ƒå¤‰æ•°ã¯å‚ç…§ã‚‚å¤‰æ›´ã‚‚ã§ãã¾ã›ã‚“
- ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å¤‰æ›´ã‚‚ã§ãã¾ã›ã‚“
- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚‚ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚‚ã§ãã¾ã›ã‚“ï¼ˆã€Œç”˜ã£ãŸã‚Œã‚‹ãªï¼ã€ã€Œé€†ã‚®ãƒ¬ï¼Ÿã€ï¼‰
- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚Luaï¼Ÿãªã‚“ã§ã™ã‹ãã‚Œã¯

ãªã‚“ã¨ã‹ã›ã‚“ã¨ã„ã‹ã‚“ã®ã§ã¯ï¼Ÿï¼ˆæ°—ãŒå‘ã„ãŸã‚‰ã€ç¶šãã‚’æ›¸ãã¾ã—ã‚‡ã†ï¼‰